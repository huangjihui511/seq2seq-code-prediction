package pers.example.xiayong.rxjavasamples.fragments;
import android.app.Activity;
import android.os.Bundle;
import android.support.v4.app.Fragment;
import java.util.List;
import java.util.concurrent.TimeUnit;
import pers.example.xiayong.rxjavasamples.MainActivity;
import rx.Observable;
import rx.Subscription;
import rx.functions.Func1;
import rx.subjects.PublishSubject;
import rx.subjects.Subject;
public class RotationPersist2WorkerFragment
extends Fragment {
private IAmYourMaster _masterFrag;
private Subscription _storedIntsSubscription;
private Subject<Integer, Integer> _intStream = PublishSubject.create();
@Override
public void onAttach(Activity activity) {
super.onAttach(activity);
List<Fragment> frags = ((MainActivity) activity).getSupportFragmentManager().getFragments();
for (Fragment f : frags) {
if (f instanceof IAmYourMaster) {
_masterFrag = (IAmYourMaster) f;
}
}
if (_masterFrag == null) {
throw new ClassCastException("We did not find a master who can understand us :(");
}
}
@Override
public void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
setRetainInstance(true);
_storedIntsSubscription =
Observable.interval(1, TimeUnit.SECONDS)
.map(new Func1<Long, Integer>() {
@Override
public Integer call(Long aLong) {
return aLong.intValue();
}
})
.take(20)
.subscribe(_intStream);
}
@Override
public void onResume() {
super.onResume();
_masterFrag.setStream(_intStream.asObservable());
}
@Override
public void onDetach() {
super.onDetach();
_masterFrag = null;
}
@Override
public void onDestroy() {
super.onDestroy();
_storedIntsSubscription.unsubscribe();
}
public interface IAmYourMaster {
void setStream(Observable<Integer> intStream);
}
}
